<p align="center">
  <img src="docs/banner.webp" alt="Open Codes banner" width="100%">
</p>

<h1 align="center">Open Codes</h1>

<p align="center">
An open dataset of French legal code articles with semantic embeddings, updated nightly.
</p>

<p align="center">
  <a href="https://huggingface.co/datasets/ArthurSrz/open_codes">HuggingFace Dataset</a> &bull;
  <a href="#quick-start">Quick Start</a> &bull;
  <a href="#how-it-works">Architecture</a> &bull;
  <a href="#license">License</a>
</p>

---

## What is Open Codes?

Open Codes provides **chunked, embedded French legal texts** from 5 major legal codes, ready for RAG pipelines, legal research, and NLP experimentation.

Each row in the dataset is a text chunk enriched with:
- **1024-dim embeddings** from Mistral AI (`mistral-embed`)
- Full article metadata from Legifrance (dates, hierarchy, status, ELI identifiers...)
- Human-readable code names and section paths

### Legal codes included

| Code | Articles |
|------|----------|
| Code civil | Core private law |
| Code de l'urbanisme | Urban planning |
| Code electoral | Electoral law |
| Code general des collectivites territoriales | Local government |
| Code des communes | Municipal law |

## Quick Start

```python
from datasets import load_dataset

ds = load_dataset("ArthurSrz/open_codes", split="train")

# Browse a chunk
row = ds[0]
print(row["code_name"])       # e.g. "Code civil"
print(row["chunk_text"][:200])
print(len(row["embedding"]))  # 1024

# Filter by legal code
code_civil = ds.filter(lambda x: x["code_name"] == "Code civil")

# Semantic search with embeddings
import numpy as np
query_emb = get_embedding("responsabilite civile")  # your embedding function
scores = np.dot(np.array(ds["embedding"]), query_emb)
top_k = np.argsort(scores)[-5:][::-1]
for i in top_k:
    print(f"{ds[i]['code_name']} {ds[i]['num']}: {ds[i]['chunk_text'][:100]}")
```

## How It Works

```
Legifrance PISTE API
        |
        v
  Xano Sync Pipeline        (nightly at 02:00 UTC)
  [SyncPopulateQueue]  -->  [SyncWorker]
        |                        |
        v                        v
  Queue items              Fetch / Hash / Chunk / Embed
        |                        |
        v                        v
  REF_codes_legifrance     REF_article_chunks
        |                        |
        +----------+-------------+
                   |
                   v
         GitHub Action           (nightly at 06:00 UTC)
         export_to_hf.py
                   |
                   v
    HuggingFace Hub: ArthurSrz/open_codes
```

**Pipeline stages:**
1. **SyncPopulateQueue** (Task 13) — runs nightly, queries Legifrance for updated articles, creates queue items
2. **SyncWorker** (Task 14) — polls queue every 4s, fetches article content, computes hashes, chunks text, generates Mistral embeddings
3. **GitHub Action** — merges chunks + articles, builds a typed HuggingFace Dataset, pushes to Hub

## Data Schema

### Key columns

| Column | Type | Description |
|--------|------|-------------|
| `chunk_text` | string | Text content of the chunk |
| `embedding` | float32[1024] | Mistral AI embedding vector |
| `code_name` | string | Human-readable code name |
| `id_legifrance` | string | Legifrance article identifier |
| `num` | string | Article number (e.g. "L. 1234-5") |
| `etat` | string | Status: VIGUEUR (in force), ABROGE (repealed) |
| `article_texte` | string | Full article plain text |
| `article_dateDebut` | string | Effective date (Unix ms) |
| `article_fullSectionsTitre` | string | Full hierarchy path |

See the [HuggingFace dataset card](https://huggingface.co/datasets/ArthurSrz/open_codes) for the complete 50+ column schema.

## License

- **Dataset**: [Licence Ouverte / Etalab 2.0](https://www.etalab.gouv.fr/licence-ouverte-open-licence/) (French open data license)
- **Source data**: [PISTE Legifrance API](https://piste.gouv.fr/) (official French government legal database)
- **Embeddings**: Generated by [Mistral AI](https://mistral.ai/) (`mistral-embed`, 1024 dimensions)

## Credits

Built by the **marIAnne** project.

- Legal data: [PISTE / Legifrance](https://piste.gouv.fr/)
- Embeddings: [Mistral AI](https://mistral.ai/)
- Backend: [Xano](https://www.xano.com/)
- Dataset hosting: [HuggingFace Hub](https://huggingface.co/)
